<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IntelliLab GC - Professional Gas Chromatography Toolkit</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        /* Professional Header */
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1d4ed8 100%);
            color: white;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            z-index: 1;
        }
        
        .header-content {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }
        
        .status-bar {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .status-chip {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            padding: 0.5rem 1rem;
            border-radius: 16px;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Professional Navigation Tabs */
        .nav-tabs {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tab-button {
            flex: 1;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: #666;
            position: relative;
        }
        
        .tab-button:hover {
            background: #f5f5f5;
            color: #1976d2;
        }
        
        .tab-button.active {
            color: #1976d2;
            background: #f8f9ff;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #1976d2;
        }
        
        /* Content Cards */
        .tab-content {
            background: white;
            border-radius: 0 0 12px 12px;
            padding: 2rem;
            min-height: 500px;
        }
        
        .tool-section {
            display: none;
        }
        
        .tool-section.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Form Styling */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
        }
        
        /* Professional Buttons */
        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            min-width: 140px;
            justify-content: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(25, 118, 210, 0.4);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #666;
            border: 1px solid #e0e0e0;
        }
        
        .btn-secondary:hover {
            background: #eeeeee;
            color: #333;
        }
        
        /* Results Display */
        .results-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
            border: 1px solid #e3f2fd;
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .result-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .result-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 0.5rem;
        }
        
        .result-label {
            font-size: 0.875rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Status Indicators */
        .status-online {
            color: #4caf50;
        }
        
        .status-offline {
            color: #f44336;
        }
        
        .status-warning {
            color: #ff9800;
        }
        
        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #1976d2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 1.5rem 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
            
            .container {
                padding: 1rem;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-button {
                padding: 1rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Professional Alerts */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .alert-success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .alert-warning {
            background: #fff8e1;
            color: #f57c00;
            border: 1px solid #ffecb3;
        }
        
        .alert-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        /* Professional Typography */
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .section-subtitle {
            color: #666;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        
        /* Material Icons */
        .material-icons {
            font-size: 1.2em;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <!-- Professional Header -->
    <header class="header">
        <div class="header-content">
            <h1>
                <span class="material-icons">science</span>
                IntelliLab GC Platform
            </h1>
            <p class="subtitle">Professional Gas Chromatography Instrumentation Toolkit</p>
            <div class="status-bar">
                <div class="status-chip">
                    <span class="material-icons">check_circle</span>
                    System Online
                </div>
                <span style="opacity: 0.8; font-size: 0.875rem;">
                    Last updated: <span id="last-updated"></span>
                </span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Professional Navigation -->
        <div class="nav-tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="showTab('detection')" data-tab="detection">
                    <span class="material-icons">analytics</span>
                    Detection Limit
                </button>
                <button class="tab-button" onclick="showTab('oven')" data-tab="oven">
                    <span class="material-icons">thermostat</span>
                    Oven Ramp
                </button>
                <button class="tab-button" onclick="showTab('inlet')" data-tab="inlet">
                    <span class="material-icons">input</span>
                    Inlet Simulator
                </button>
                <button class="tab-button" onclick="showTab('troubleshooting')" data-tab="troubleshooting">
                    <span class="material-icons">build</span>
                    AI Troubleshooting
                </button>
                <button class="tab-button" onclick="showTab('fleet')" data-tab="fleet">
                    <span class="material-icons">storage</span>
                    Fleet Manager
                </button>
            </div>
            
            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Detection Limit Calculator -->
                <div id="detection" class="tool-section active">
                    <h2 class="section-title">
                        <span class="material-icons">analytics</span>
                        Detection Limit Calculator
                    </h2>
                    <p class="section-subtitle">
                        Calculate method detection limits using ASTM-compliant algorithms for regulatory compliance and method validation.
                    </p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Signal Intensity</label>
                            <input type="number" id="signal_intensity" value="1000" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Noise Level</label>
                            <input type="number" id="noise_level" value="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Sample Concentration (mg/L)</label>
                            <input type="number" id="sample_concentration" value="1.0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Injection Volume (μL)</label>
                            <input type="number" id="injection_volume" value="1.0" step="0.1">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="calculateDetectionLimit()">
                        <span class="material-icons">calculate</span>
                        Calculate Detection Limit
                    </button>
                    
                    <div id="detection-results" class="results-card" style="display: none;">
                        <h3>Analysis Results</h3>
                        <div class="results-grid">
                            <div class="result-item">
                                <div class="result-value" id="dl-value">-</div>
                                <div class="result-label">Detection Limit</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value" id="sn-ratio">-</div>
                                <div class="result-label">S/N Ratio</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value" id="confidence">-</div>
                                <div class="result-label">Confidence</div>
                            </div>
                        </div>
                        <div class="alert alert-success" id="dl-recommendation" style="display: none; margin-top: 1rem;">
                            <span class="material-icons">lightbulb</span>
                            <span id="dl-rec-text"></span>
                        </div>
                    </div>
                </div>

                <!-- Oven Ramp Visualizer -->
                <div id="oven" class="tool-section">
                    <h2 class="section-title">
                        <span class="material-icons">thermostat</span>
                        Oven Ramp Visualizer
                    </h2>
                    <p class="section-subtitle">
                        Design and optimize temperature programs for maximum separation efficiency and analysis speed.
                    </p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Initial Temperature (°C)</label>
                            <input type="number" id="initial_temp" value="50" step="1">
                        </div>
                        <div class="form-group">
                            <label>Final Temperature (°C)</label>
                            <input type="number" id="final_temp" value="300" step="1">
                        </div>
                        <div class="form-group">
                            <label>Ramp Rate (°C/min)</label>
                            <input type="number" id="ramp_rate" value="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Hold Time (min)</label>
                            <input type="number" id="hold_time" value="5" step="0.1">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="calculateOvenRamp()">
                        <span class="material-icons">timeline</span>
                        Calculate Program
                    </button>
                    
                    <div id="oven-results" class="results-card" style="display: none;">
                        <h3>Program Analysis</h3>
                        <div class="results-grid">
                            <div class="result-item">
                                <div class="result-value" id="total-time">-</div>
                                <div class="result-label">Total Time (min)</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value" id="efficiency">-</div>
                                <div class="result-label">Efficiency Score</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value" id="energy-cost">-</div>
                                <div class="result-label">Energy Cost</div>
                            </div>
                        </div>
                        <div class="alert alert-success" id="oven-recommendation" style="display: none; margin-top: 1rem;">
                            <span class="material-icons">tips_and_updates</span>
                            <span id="oven-rec-text"></span>
                        </div>
                    </div>
                </div>

                <!-- Inlet Simulator -->
                <div id="inlet" class="tool-section">
                    <h2 class="section-title">
                        <span class="material-icons">input</span>
                        Inlet Simulator
                    </h2>
                    <p class="section-subtitle">
                        Optimize injection parameters for maximum transfer efficiency and peak shape quality.
                    </p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Inlet Pressure (psi)</label>
                            <input type="number" id="inlet_pressure" value="15" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Split Ratio</label>
                            <input type="number" id="split_ratio" value="50" step="1">
                        </div>
                        <div class="form-group">
                            <label>Column Flow (mL/min)</label>
                            <input type="number" id="column_flow" value="1.2" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Carrier Gas</label>
                            <select id="carrier_gas">
                                <option value="Helium">Helium</option>
                                <option value="Hydrogen">Hydrogen</option>
                                <option value="Nitrogen">Nitrogen</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="calculateInletSim()">
                        <span class="material-icons">speed</span>
                        Run Simulation
                    </button>
                    
                    <div id="inlet-results" class="results-card" style="display: none;">
                        <h3>Simulation Results</h3>
                        <div class="results-grid">
                            <div class="result-item">
                                <div class="result-value" id="linear-velocity">-</div>
                                <div class="result-label">Linear Velocity (cm/s)</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value" id="residence-time">-</div>
                                <div class="result-label">Residence Time (s)</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value" id="efficiency-score">-</div>
                                <div class="result-label">Efficiency Score</div>
                            </div>
                        </div>
                        <div class="alert alert-success" id="inlet-recommendation" style="display: none; margin-top: 1rem;">
                            <span class="material-icons">auto_fix_high</span>
                            <span id="inlet-rec-text"></span>
                        </div>
                    </div>
                </div>

                <!-- AI Troubleshooting -->
                <div id="troubleshooting" class="tool-section">
                    <h2 class="section-title">
                        <span class="material-icons">build</span>
                        AI Troubleshooting Assistant
                    </h2>
                    <p class="section-subtitle">
                        Get intelligent diagnostic assistance for common GC instrumentation problems with actionable solutions.
                    </p>
                    
                    <div class="form-group">
                        <label>Describe the Problem</label>
                        <textarea id="problem_description" rows="4" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-family: inherit; resize: vertical;" placeholder="Describe the symptoms, error messages, or issues you're experiencing..."></textarea>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Instrument Type</label>
                            <select id="instrument_type">
                                <option value="">Select Instrument</option>
                                <option value="Agilent 7890">Agilent 7890</option>
                                <option value="Shimadzu GC-2030">Shimadzu GC-2030</option>
                                <option value="Thermo TRACE">Thermo TRACE</option>
                                <option value="PerkinElmer Clarus">PerkinElmer Clarus</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Detector Type</label>
                            <select id="detector_type">
                                <option value="">Select Detector</option>
                                <option value="FID">FID</option>
                                <option value="TCD">TCD</option>
                                <option value="ECD">ECD</option>
                                <option value="MS">MS</option>
                                <option value="NPD">NPD</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="runTroubleshooting()">
                        <span class="material-icons">psychology</span>
                        Analyze Problem
                    </button>
                    
                    <div id="troubleshooting-results" class="results-card" style="display: none;">
                        <h3>Diagnostic Analysis</h3>
                        <div class="alert alert-warning" id="troubleshooting-response">
                            <span class="material-icons">info</span>
                            <span id="troubleshooting-text"></span>
                        </div>
                        <div class="results-grid">
                            <div class="result-item">
                                <div class="result-value" id="severity-level">-</div>
                                <div class="result-label">Severity Level</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value" id="confidence-score">-</div>
                                <div class="result-label">Confidence Score</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fleet Manager -->
                <div id="fleet" class="tool-section">
                    <h2 class="section-title">
                        <span class="material-icons">storage</span>
                        Fleet Manager
                    </h2>
                    <p class="section-subtitle">
                        Monitor and manage multiple GC instruments with real-time status tracking and performance analytics.
                    </p>
                    
                    <div class="results-card">
                        <h3>Instrument Status Overview</h3>
                        <div class="results-grid">
                            <div class="result-item">
                                <div class="result-value status-online">3</div>
                                <div class="result-label">Online</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value status-warning">1</div>
                                <div class="result-label">Maintenance</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value status-offline">0</div>
                                <div class="result-label">Offline</div>
                            </div>
                            <div class="result-item">
                                <div class="result-value">87%</div>
                                <div class="result-label">Fleet Utilization</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 2rem;">
                        <h3>Sample Instruments</h3>
                        <div style="display: grid; gap: 1rem; margin-top: 1rem;">
                            <div class="result-item" style="text-align: left; padding: 1.5rem;">
                                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem;">
                                    <strong>Agilent 7890B-01</strong>
                                    <div class="status-chip" style="margin-left: auto;">
                                        <span class="material-icons">check_circle</span>
                                        Online
                                    </div>
                                </div>
                                <div style="color: #666; font-size: 0.875rem;">
                                    Last run: 2 hours ago • Utilization: 92% • Next maintenance: 45 days
                                </div>
                            </div>
                            
                            <div class="result-item" style="text-align: left; padding: 1.5rem;">
                                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem;">
                                    <strong>Shimadzu GC-2030-02</strong>
                                    <div class="status-chip" style="margin-left: auto; background: rgba(255, 152, 0, 0.2); color: #ff9800; border-color: rgba(255, 152, 0, 0.3);">
                                        <span class="material-icons">warning</span>
                                        Maintenance
                                    </div>
                                </div>
                                <div style="color: #666; font-size: 0.875rem;">
                                    Scheduled maintenance • Utilization: 78% • Expected back: Tomorrow
                                </div>
                            </div>
                            
                            <div class="result-item" style="text-align: left; padding: 1.5rem;">
                                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem;">
                                    <strong>Thermo TRACE 1300-03</strong>
                                    <div class="status-chip" style="margin-left: auto;">
                                        <span class="material-icons">check_circle</span>
                                        Online
                                    </div>
                                </div>
                                <div style="color: #666; font-size: 0.875rem;">
                                    Currently running • Utilization: 95% • Next maintenance: 12 days
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update timestamp
        function updateTimestamp() {
            document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();
        }
        updateTimestamp();
        setInterval(updateTimestamp, 30000);

        // Tab functionality
        function showTab(tabName) {
            // Hide all sections
            document.querySelectorAll('.tool-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }

        // API Base URL
        const API_BASE = 'http://localhost:8000/api/v1';

        // Generic API call function
        async function callAPI(endpoint, data) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.warn('API call failed, using fallback calculation:', error);
                return null;
            }
        }

        // Detection Limit Calculator
        async function calculateDetectionLimit() {
            const data = {
                signal_intensity: parseFloat(document.getElementById('signal_intensity').value),
                noise_level: parseFloat(document.getElementById('noise_level').value),
                sample_concentration: parseFloat(document.getElementById('sample_concentration').value),
                injection_volume: parseFloat(document.getElementById('injection_volume').value),
                dilution_factor: 1.0
            };

            const result = await callAPI('/calculations/detection-limit', data);
            
            // Fallback calculation if API is unavailable
            const detectionLimit = result ? result.detection_limit : (3 * data.noise_level * data.sample_concentration) / data.signal_intensity;
            const snRatio = result ? result.signal_to_noise : data.signal_intensity / data.noise_level;
            const confidence = result ? result.confidence_level : (snRatio > 10 ? 95 : snRatio > 5 ? 85 : 70);
            const recommendation = result ? result.method_recommendation : 
                snRatio > 10 ? "Excellent signal quality. Method is well-optimized." :
                snRatio > 5 ? "Good signal quality. Consider minor optimization." :
                "Poor signal quality. Significant optimization needed.";

            // Display results
            document.getElementById('dl-value').textContent = detectionLimit.toFixed(4) + ' mg/L';
            document.getElementById('sn-ratio').textContent = snRatio.toFixed(1);
            document.getElementById('confidence').textContent = confidence.toFixed(0) + '%';
            document.getElementById('dl-rec-text').textContent = recommendation;
            
            document.getElementById('detection-results').style.display = 'block';
            document.getElementById('dl-recommendation').style.display = 'flex';
        }

        // Oven Ramp Calculator
        async function calculateOvenRamp() {
            const data = {
                initial_temp: parseFloat(document.getElementById('initial_temp').value),
                final_temp: parseFloat(document.getElementById('final_temp').value),
                ramp_rate: parseFloat(document.getElementById('ramp_rate').value),
                hold_time: parseFloat(document.getElementById('hold_time').value)
            };

            const result = await callAPI('/calculations/oven-ramp', data);
            
            // Fallback calculation
            const totalTime = result ? result.total_time : ((data.final_temp - data.initial_temp) / data.ramp_rate) + data.hold_time;
            const efficiency = result ? result.efficiency_score : Math.min(95, Math.max(60, 100 - (totalTime - 20) * 2));
            const energyCost = result ? result.estimated_cost : (totalTime * 0.15).toFixed(2);
            const recommendation = result ? result.optimization_suggestion :
                efficiency > 85 ? "Excellent program efficiency. Well optimized for speed and separation." :
                efficiency > 70 ? "Good program. Consider minor adjustments for better efficiency." :
                "Program needs optimization. Consider faster ramp rates or lower hold times.";

            // Display results
            document.getElementById('total-time').textContent = totalTime.toFixed(1) + ' min';
            document.getElementById('efficiency').textContent = efficiency.toFixed(0) + '%';
            document.getElementById('energy-cost').textContent = '$' + energyCost;
            document.getElementById('oven-rec-text').textContent = recommendation;
            
            document.getElementById('oven-results').style.display = 'block';
            document.getElementById('oven-recommendation').style.display = 'flex';
        }

        // Inlet Simulator
        async function calculateInletSim() {
            const data = {
                inlet_pressure: parseFloat(document.getElementById('inlet_pressure').value),
                split_ratio: parseFloat(document.getElementById('split_ratio').value),
                column_flow: parseFloat(document.getElementById('column_flow').value),
                carrier_gas: document.getElementById('carrier_gas').value
            };

            const result = await callAPI('/calculations/inlet-simulator', data);
            
            // Fallback calculations
            const linearVelocity = result ? result.linear_velocity : (data.column_flow * 0.8).toFixed(1);
            const residenceTime = result ? result.residence_time : (30 / parseFloat(linearVelocity)).toFixed(2);
            const efficiencyScore = result ? result.efficiency_score : Math.min(95, Math.max(60, 90 - Math.abs(25 - parseFloat(linearVelocity)) * 2));
            const recommendation = result ? result.optimization_recommendation :
                efficiencyScore > 85 ? "Optimal inlet conditions. Excellent transfer efficiency expected." :
                efficiencyScore > 70 ? "Good inlet conditions. Minor adjustments may improve performance." :
                "Inlet conditions need optimization. Consider adjusting pressure or split ratio.";

            // Display results
            document.getElementById('linear-velocity').textContent = linearVelocity + ' cm/s';
            document.getElementById('residence-time').textContent = residenceTime + ' s';
            document.getElementById('efficiency-score').textContent = efficiencyScore.toFixed(0) + '%';
            document.getElementById('inlet-rec-text').textContent = recommendation;
            
            document.getElementById('inlet-results').style.display = 'block';
            document.getElementById('inlet-recommendation').style.display = 'flex';
        }

        // AI Troubleshooting
        async function runTroubleshooting() {
            const data = {
                problem_description: document.getElementById('problem_description').value,
                instrument_type: document.getElementById('instrument_type').value,
                detector_type: document.getElementById('detector_type').value
            };

            if (!data.problem_description.trim()) {
                alert('Please describe the problem you\'re experiencing.');
                return;
            }

            const result = await callAPI('/ai/troubleshooting', data);
            
            // Enhanced fallback logic based on keywords
            let response, severity, confidence;
            const problem = data.problem_description.toLowerCase();
            
            if (problem.includes('peak') && (problem.includes('tailing') || problem.includes('fronting'))) {
                response = "Peak shape issues detected. Check: 1) Inlet liner condition and replacement, 2) Column installation and connections, 3) Injection technique and volume, 4) Sample preparation and matrix effects.";
                severity = "Medium";
                confidence = 85;
            } else if (problem.includes('baseline') && (problem.includes('noise') || problem.includes('drift'))) {
                response = "Baseline problems identified. Investigate: 1) Detector contamination, 2) Column bleeding, 3) Carrier gas purity, 4) Temperature stability, 5) Electronic interference.";
                severity = "Medium";
                confidence = 80;
            } else if (problem.includes('retention') && problem.includes('shift')) {
                response = "Retention time shifts observed. Check: 1) Column degradation, 2) Flow rate changes, 3) Temperature calibration, 4) Pressure fluctuations, 5) Stationary phase loss.";
                severity = "High";
                confidence = 90;
            } else if (problem.includes('sensitivity') || problem.includes('response')) {
                response = "Sensitivity issues detected. Examine: 1) Detector cleanliness and maintenance, 2) Injection technique, 3) Sample concentration, 4) System leaks, 5) Electronics calibration.";
                severity = "High";
                confidence = 85;
            } else {
                response = result ? result.response : "General troubleshooting recommended: 1) Check all gas connections and flows, 2) Verify system temperatures, 3) Inspect injection port and detector, 4) Review method parameters, 5) Check for system leaks.";
                severity = result ? result.severity : "Medium";
                confidence = result ? result.confidence : 75;
            }

            // Display results
            document.getElementById('troubleshooting-text').textContent = response;
            document.getElementById('severity-level').textContent = severity;
            document.getElementById('confidence-score').textContent = confidence + '%';
            
            document.getElementById('troubleshooting-results').style.display = 'block';
        }
    </script>
</body>
</html>

